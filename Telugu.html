<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />


    <title> ‡∞∂‡±Å‡∞ï‡±ç‡∞≤‡∞Ø‡∞ú‡±Å‡∞∞‡±ç‡∞µ‡±á‡∞¶‡∞Ç</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/tesseract.js@4.1.0/dist/tesseract.min.js"></script>

     
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* CSS for Responsive Design and Styling */
        :root {
            --primary-color: #5a67d8;
            --primary-dark: #4c51bf;
            --secondary-color: #e2e8f0;
            --secondary-dark: #cbd5e1;
            --background-color: #f0f4f8;
            --card-background: #ffffff;
            --text-color: #2d3748;
            --light-text-color: #718096;
            --border-color: #e2e8f0;
            --success-color: #48bb78;
            --error-color: #c0392b;
            --info-color: #4299e1;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --box-shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.12);
            --pitch-high-color: #1f3674;
            --pitch-low-color: #a08b5e;
            --pitch-svarita-color: #c0392b;
            --pitch-dirgha-color: #27ae60;
            --button-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1, h2, h3 {
            font-family: 'Noto Sans Telugu', serif;
            color: var(--primary-dark);
            text-align: center;
            margin-bottom: 1.5rem;
            letter-spacing: -0.5px;
        }
        .main-container {
            max-width: 960px;
            width: 100%;
        }
        .section {
            background: var(--card-background);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 2rem;
            transition: box-shadow 0.3s ease;
        }
        .section:hover {
            box-shadow: var(--box-shadow-hover);
        }
        .status {
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: var(--button-shadow);
        }
        .status.info { background: #e6f4ff; color: #1c7ed6; }
        .status.success { background: #e9f5e9; color: #2f855a; }
        .status.error { background: #ffebeb; color: #c0392b; }
        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: 'Roboto', sans-serif;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            gap: 0.5rem;
            box-shadow: var(--button-shadow);
        }
        .button:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .button:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: var(--button-shadow);
        }
        .button:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            color: #94a3b8;
            box-shadow: none;
        }
        .secondary-btn {
            background: var(--secondary-color);
            color: var(--text-color);
        }
        .secondary-btn:hover:not(:disabled) {
            background: var(--secondary-dark);
        }
        .flex-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        img#preview {
            max-width: 100%;
            max-height: 300px;
            display: none;
            margin: 1.5rem auto;
            border-radius: var(--border-radius);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            object-fit: contain;
        }
        label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: block;
            color: var(--text-color);
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1.25rem;
            font-family: 'Noto Sans Telugu', serif;
            background: var(--background-color);
            transition: border-color 0.2s ease;
            resize: vertical;
            min-height: 150px;
        }
        input[type="text"] {
            min-height: unset;
            height: 48px;
            font-size: 1rem;
        }
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.2);
        }
        .pitch-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .pitch-marked-char {
            position: relative;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.5;
            font-family: 'Noto Sans Telugu', serif;
            text-align: center;
            cursor: pointer;
            padding: 0.4em 0.2em;
            transition: background-color 0.2s ease;
        }
        .pitch-marked-char:hover {
            background-color: var(--secondary-color);
            border-radius: 4px;
        }
        .pitch-marked-char.high::before {
            content: "‚ñ≤";
            position: absolute;
            top: -0.7em;
            left: 50%;
            transform: translateX(-50%);
            color: var(--pitch-high-color);
            font-size: 0.8em;
            margin-top: 0.2em;
        }
        .pitch-marked-char.low::after {
            content: "‚ñº";
            position: absolute;
            bottom: -0.5em;
            left: 50%;
            transform: translateX(-50%);
            color: var(--pitch-low-color);
            font-size: 0.8em;
        }
        /* .pitch-marked-char.svarita::before {
            content: "‚åí";
            position: absolute;
            top: -0.7em;
            left: 50%;
            transform: translateX(-50%);
            color: var(--pitch-svarita-color);
            font-size: 0.8em;
            margin-top: 0.2em;
        }
        .pitch-marked-char.dirgha-svarita::before {
            content: "„Ä∞";
            position: absolute;
            top: -0.7em;
            left: 50%;
            transform: translateX(-50%);
            color: var(--pitch-dirgha-color);
            font-size: 0.8em;
            margin-top: 0.2em;
        } */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab-container {
            display: flex;
            flex-wrap: nowrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding-bottom: 10px;
        }
        .tab-container::-webkit-scrollbar {
            display: none;
        }
        .tab-button {
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Roboto', sans-serif;
            font-weight: 500;
            background: var(--secondary-color);
            border: 1px solid var(--border-color);
            padding: 0.75rem 1.25rem;
            border-radius: var(--border-radius);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            white-space: nowrap;
        }
        .tab-button:hover:not(.active) {
            transform: translateY(-2px);
            background: var(--secondary-dark);
        }
        .tab-button.active {
            background: var(--primary-color);
            color: white;
            border: 1px solid var(--primary-color);
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.2);
        }
        .tab-button-content {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .tab-button .control-btn {
            background: none;
            border: none;
            color: var(--light-text-color);
            cursor: pointer;
            padding: 0;
            line-height: 1;
            font-size: 1.2rem;
            transition: color 0.2s ease, transform 0.2s ease;
            margin-left: 0.75rem;
        }
        .tab-button.active .control-btn {
            color: white;
        }
        .tab-button .control-btn:hover {
            color: var(--primary-dark);
            transform: scale(1.1);
        }
        .tab-button.active .control-btn:hover {
            color: #fff;
        }
        .tab-button .control-btn.delete-btn:hover {
            color: var(--error-color);
        }
        .mantra-card {
            background: var(--background-color);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }
        .mantra-card h3 {
            margin-top: 0;
            color: var(--primary-dark);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .mantra-card p {
            color: var(--light-text-color);
        }
        .mantra-card .pitch-display {
            font-size: 1.25rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 2.2;
            text-align: justify;
        }
        .help-content {
            display: none;
            margin-top: 1.5rem;
            font-family: 'Noto Sans Telugu', serif;
            text-align: left;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--secondary-color);
        }
        .help-content h3 {
            text-align: left;
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.2rem;
        }
        .help-content ol {
            padding-left: 1.5rem;
            line-height: 1.8;
            font-size: 1rem;
        }
        .help-content li {
            margin-bottom: 0.5rem;
        }
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            .section {
                padding: 1.5rem;
            }
            h1, h2 {
                font-size: 1.5rem;
            }
            .button {
                width: 100%;
            }
            .flex-container {
                flex-direction: column;
                gap: 1.5rem;
            }
            .tab-button {
                width: auto;
            }
        }
        #bookSelect, #sectionSelect {
            width: 100%;
            padding: 0.75rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            font-size: 1rem;
            background-color: white;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
<header class="header-fixed" role="banner">
  <div class="container header-content">
    <div class="logo">
      <a href="index.html" aria-label="‡∞Ö‡∞ï‡±ç‡∞∑‡∞∞‡∞ß‡∞æ‡∞∞ ‡∞π‡±ã‡∞Æ‡±ç">‡∞Ö‡∞ï‡±ç‡∞∑‡∞∞‡∞ß‡∞æ‡∞∞</a>
    </div>
    <nav id="nav-links" class="nav-links" aria-label="‡∞™‡±ç‡∞∞‡∞ß‡∞æ‡∞® ‡∞®‡∞æ‡∞µ‡∞ø‡∞ó‡±á‡∞∑‡∞®‡±ç">
      <a href="index.html" class="nav-link text-lg font-medium">
        <i class="fas fa-home"></i> ‡∞π‡±ã‡∞Æ‡±ç
      </a>
      <a href="aksharadhara.html" class="nav-link text-lg font-medium">
        <i class="fas fa-file-alt"></i> ‡∞Ö‡∞ï‡±ç‡∞∑‡∞∞‡∞ß‡∞æ‡∞∞
      </a>
         <a href="‡∞∂‡±Å‡∞ï‡±ç‡∞≤‡∞Ø‡∞ú‡±Å‡∞∞‡±ç‡∞µ‡±á‡∞¶‡∞Ç.html" class="nav-link text-lg font-medium"> <i class="fas fa-feather-alt"></i>‡∞∂‡±Å‡∞ï‡±ç‡∞≤ ‡∞Ø‡∞ú‡±Å‡∞∞‡±ç‡∞µ‡±á‡∞¶‡∞Ç</a>
            <a href="shruti-sankalanam.html" role="menuitem"> <i class="fas fa-feather-alt"></i>‡∞ï‡±É‡∞∑‡±ç‡∞£ ‡∞Ø‡∞ú‡±Å‡∞∞‡±ç‡∞µ‡±á‡∞¶‡∞Ç</a>
         <a href="Telugu.html" class="nav-link text-lg font-medium"><i class="fas fa-feather-alt"></i> ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞ï‡∞µ‡∞ø‡∞§‡±ç‡∞µ‡∞Ç</a>
    </nav>
    <button id="hamburger-icon" class="hamburger-icon" aria-label="‡∞Æ‡±Ü‡∞®‡±Ç ‡∞§‡±Ü‡∞∞‡∞µ‡∞Ç‡∞°‡∞ø" aria-controls="nav-links" aria-expanded="false" aria-haspopup="true" type="button">
      <svg class="w-8 h-8 text-[#1f3674]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
      </svg>
    </button>
  </div>
</header>

    <div class="main-container">
      <main class="content-area p-4 md:p-8" id="main-content" role="main">
      <div class="container text-center py-8 md:py-16">
      <h1 class="text-3xl md:text-5xl font-extrabold text-[#1f3674] mb-4"> ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞ï‡∞µ‡∞ø‡∞§‡±ç‡∞µ‡∞Ç</h1>
  <p class="text-lg md:text-xl text-[#4a5568] font-semibold">‡∞Æ‡±Ä ‡∞Ü‡∞ß‡±ç‡∞Ø‡∞æ‡∞§‡±ç‡∞Æ‡∞ø‡∞ï ‡∞ó‡±ç‡∞∞‡∞Ç‡∞•‡∞æ‡∞≤‡∞®‡±Å ‡∞∏‡±Å‡∞≤‡∞≠‡∞Ç‡∞ó‡∞æ ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±à‡∞ú‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞π‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞í‡∞ï ‡∞∂‡∞ï‡±ç‡∞§‡∞ø‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞® ‡∞∏‡∞æ‡∞ß‡∞®‡∞Ç.</p>
        
 
        <div class="status info" id="status">‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.</div>
    <div class="section" id="helperSection">
    <h2 style="cursor:pointer;" id="helperToggleBtn">‡∞∂‡±ç‡∞∞‡±Å‡∞§‡∞ø ‡∞∏‡∞Ç‡∞ï‡∞≤‡∞®‡∞Ç: ‡∞é‡∞≤‡∞æ ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ø? üìñ <span id="helperArrow">‚ñº</span></h2>
    <div id="helperContent" class="help-content">
        <p>‡∞∂‡±ç‡∞∞‡±Å‡∞§‡∞ø ‡∞∏‡∞Ç‡∞ï‡∞≤‡∞®‡∞Ç ‡∞Ö‡∞®‡±á‡∞¶‡∞ø ‡∞Æ‡±Ä ‡∞Ü‡∞ß‡±ç‡∞Ø‡∞æ‡∞§‡±ç‡∞Æ‡∞ø‡∞ï ‡∞ó‡±ç‡∞∞‡∞Ç‡∞•‡∞æ‡∞≤‡∞®‡±Å ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±à‡∞ú‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞µ‡∞æ‡∞ü‡∞ø‡∞ï‡∞ø ‡∞∏‡±ç‡∞µ‡∞∞‡∞æ‡∞≤‡∞®‡±Å (‡∞™‡∞ø‡∞ö‡±ç ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Å‡∞≤‡∞®‡±Å) ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞™‡∞°‡±á ‡∞í‡∞ï ‡∞∏‡∞æ‡∞ß‡∞®‡∞Ç. ‡∞¶‡±Ä‡∞®‡±ç‡∞®‡∞ø ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç ‡∞ö‡∞æ‡∞≤‡∞æ ‡∞∏‡±Å‡∞≤‡∞≠‡∞Ç, ‡∞ï‡±á‡∞µ‡∞≤‡∞Ç ‡∞à 5 ‡∞¶‡∞∂‡∞≤‡∞®‡±Å ‡∞Ö‡∞®‡±Å‡∞∏‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø:</p>
        <ol>
            <li><b>‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø:</b> ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±à‡∞ú‡±ç ‡∞ö‡±á‡∞Ø‡∞æ‡∞≤‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞® ‡∞ó‡±ç‡∞∞‡∞Ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞í‡∞ï ‡∞™‡±á‡∞∞‡±Å ‡∞™‡±Ü‡∞ü‡±ç‡∞ü‡∞Ç‡∞°‡∞ø (‡∞â‡∞¶‡∞æ: "‡∞ó‡±ç‡∞∞‡∞Ç‡∞•‡∞Ç"). ‡∞Ü ‡∞§‡∞∞‡±ç‡∞µ‡∞æ‡∞§, ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞≤‡±ã ‡∞í‡∞ï ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø (‡∞â‡∞¶‡∞æ: "‡∞™‡±Ç‡∞∞‡±ç‡∞µ ‡∞™‡±Ä‡∞†‡∞ø‡∞ï").</li>
            <li><b>‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞∏‡∞ø, ‡∞ü‡±Ü‡∞ï‡±ç‡∞∏‡±ç‡∞ü‡±ç ‡∞™‡±ä‡∞Ç‡∞¶‡∞Ç‡∞°‡∞ø:</b> ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞Ç ‡∞â‡∞®‡±ç‡∞® ‡∞í‡∞ï ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Æ‡±Ä ‡∞´‡±ã‡∞®‡±ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞ï‡∞Ç‡∞™‡±ç‡∞Ø‡±Ç‡∞ü‡∞∞‡±ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø. 'OCR ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø' ‡∞¨‡∞ü‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞®‡±ä‡∞ï‡±ç‡∞ï‡∞Ç‡∞°‡∞ø. ‡∞á‡∞¶‡∞ø ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞Ö‡∞ï‡±ç‡∞∑‡∞∞‡∞æ‡∞≤‡∞®‡±Å ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡∞ø, ‡∞µ‡∞æ‡∞ü‡∞ø‡∞®‡∞ø ‡∞Æ‡±Ä‡∞ï‡±Å ‡∞ü‡±Ü‡∞ï‡±ç‡∞∏‡±ç‡∞ü‡±ç ‡∞∞‡±Ç‡∞™‡∞Ç‡∞≤‡±ã ‡∞á‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.</li>
            <li><b>‡∞™‡∞ø‡∞ö‡±ç ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Å‡∞≤‡∞®‡±Å ‡∞ú‡∞§ ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø:</b> OCR ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞µ‡∞ö‡±ç‡∞ö‡∞ø‡∞® ‡∞ü‡±Ü‡∞ï‡±ç‡∞∏‡±ç‡∞ü‡±ç‚Äå‡∞≤‡±ã, ‡∞è ‡∞Ö‡∞ï‡±ç‡∞∑‡∞∞‡∞æ‡∞≤‡∞ï‡±Å ‡∞™‡∞ø‡∞ö‡±ç ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Å‡∞≤‡±Å ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡±ã ‡∞µ‡∞æ‡∞ü‡∞ø‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø. ‡∞Ü ‡∞§‡∞∞‡±ç‡∞µ‡∞æ‡∞§, ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞∏‡±ç‡∞µ‡∞∞‡∞ø‡∞§‡∞Ç
, ‡∞Ö‡∞®‡±Å‡∞¶‡∞æ‡∞§‡±ç‡∞§‡∞Ç, ‡∞∏‡±ç‡∞µ‡∞∞‡∞ø‡∞§‡∞Ç, ‡∞≤‡±á‡∞¶‡∞æ ‡∞¶‡±Ä‡∞∞‡±ç‡∞ò ‡∞∏‡±ç‡∞µ‡∞∞‡∞ø‡∞§‡∞Ç ‡∞µ‡∞Ç‡∞ü‡∞ø ‡∞∏‡∞∞‡±à‡∞® ‡∞™‡∞ø‡∞ö‡±ç‚Äå‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.</li>
            <li><b>‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø:</b> ‡∞Æ‡±Ä ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞í‡∞ï ‡∞™‡±á‡∞∞‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞£ ‡∞á‡∞ö‡±ç‡∞ö‡∞ø, '‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø' ‡∞¨‡∞ü‡∞®‡±ç‚Äå‡∞™‡±à ‡∞ï‡±ç‡∞≤‡∞ø‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.</li>
            <li><b>‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞≤‡∞®‡±Å ‡∞ö‡±Ç‡∞∏‡∞ø, ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞∏‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø:</b> ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞∏‡∞ø‡∞® ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞≤‡∞®‡±Å ‡∞é‡∞™‡±ç‡∞™‡±Å‡∞°‡±à‡∞®‡∞æ ‡∞ö‡±Ç‡∞∏‡±Å‡∞ï‡±ã‡∞µ‡∞ö‡±ç‡∞ö‡±Å. ‡∞Ö‡∞®‡±ç‡∞®‡±Ä ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞Ø‡±ç‡∞Ø‡∞æ‡∞ï, '‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø' ‡∞¨‡∞ü‡∞®‡±ç‚Äå‡∞™‡±à ‡∞ï‡±ç‡∞≤‡∞ø‡∞ï‡±ç ‡∞ö‡±á‡∞∏‡∞ø, ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø HTML ‡∞´‡±à‡∞≤‡±ç‚Äå‡∞ó‡∞æ ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞∏‡±Å‡∞ï‡±ã‡∞µ‡∞ö‡±ç‡∞ö‡±Å.</li>
        </ol>
    </div>
</div>


        <div class="section" id="bookCreationSection">
            <h2>1. ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</h2>
            <label for="newBookTitle">‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç ‡∞™‡±á‡∞∞‡±Å (Book Title):</label>
            <input type="text" id="newBookTitle" placeholder="‡∞â‡∞¶‡∞æ: ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å">
            <div class="flex-container">
                <button class="button" id="createNewBookBtn">‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</button>
            </div>
            <div style="margin-top: 1.5rem; text-align: center;">‡∞≤‡±á‡∞¶‡∞æ</div>
            <label for="bookSelect" style="margin-top: 1.5rem;">‡∞á‡∞™‡±ç‡∞™‡∞ü‡∞ø‡∞ï‡±á ‡∞â‡∞®‡±ç‡∞® ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø:</label>
            <select id="bookSelect"></select>
            <div class="flex-container">
                <button class="button secondary-btn" id="deleteBookBtn">‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</button>
            </div>
        </div>

        <div class="section" id="sectionCreationSection" style="display: none;">
            <h2>2. ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</h2>
            <label for="newSectionTitle">‡∞≠‡∞æ‡∞ó‡∞æ‡∞Ç ‡∞™‡±á‡∞∞‡±Å (Section Title):</label>
            <input type="text" id="newSectionTitle" placeholder="‡∞â‡∞¶‡∞æ: ‡∞™‡±Ç‡∞∞‡±ç‡∞µ ‡∞™‡±Ä‡∞†‡∞ø‡∞ï">
            <div class="flex-container">
                <button class="button" id="addNewSectionBtn">‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</button>
            </div>
            <div style="margin-top: 1.5rem; text-align: center;">‡∞≤‡±á‡∞¶‡∞æ</div>
            <label for="sectionSelect" style="margin-top: 1.5rem;">‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø:</label>
            <select id="sectionSelect"></select>
            <div class="flex-container">
                <button class="button secondary-btn" id="deleteSectionBtn">‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</button>
            </div>
        </div>
        
        <div class="section" id="ocrSection" style="display: none;">
            <h2>3. ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø‡∞Ç‡∞°‡∞ø ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞µ‡±Ü‡∞≤‡∞ø‡∞ï‡∞ø‡∞§‡±Ä‡∞Ø‡∞Ç‡∞°‡∞ø</h2>
            <div class="flex-container">
                <div class="file-input-wrapper">
                    <button class="button" id="uploadBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                        ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø
                        <input type="file" id="imageInput" class="file-input" accept="image/*" />
                    </button>
                </div>
                <button class="button" id="btnOcr" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scan-text"><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/><path d="M7 12h10"/><path d="M7 18h7"/><path d="M10 6h4"/></svg>
                    OCR ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø
                    <span id="ocrSpinner" class="spinner"></span>
                </button>
            </div>
            <img id="preview" alt="Uploaded Image" />
            <div style="margin-top: 1.5rem; text-align: left;">
                <label for="ocrText">OCR ‡∞Ö‡∞µ‡±Å‡∞ü‡±ç‚Äå‡∞™‡±Å‡∞ü‡±ç ‡∞∏‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø </label>
                <textarea id="ocrText" placeholder="OCR ‡∞´‡∞≤‡∞ø‡∞§‡∞Ç ‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø"></textarea>
             <!--    <div class="pitch-buttons">
                    <button class="button secondary-btn" id="btnPitchHigh">‡∞∏‡±ç‡∞µ‡∞∞‡∞ø‡∞§‡∞Ç
 (High) üîº</button>
                    <button class="button secondary-btn" id="btnPitchLow">‡∞Ö‡∞®‡±Å‡∞¶‡∞æ‡∞§‡±ç‡∞§‡∞Ç (Low) üîΩ</button>
               <!--      <button class="button secondary-btn" id="btnPitchSvarita">‡∞∏‡±ç‡∞µ‡∞∞‡∞ø‡∞§‡∞Ç (Svarita) ‚åí</button>
                    <button class="button secondary-btn" id="btnPitchDirgha">‡∞¶‡±Ä‡∞∞‡±ç‡∞ò ‡∞∏‡±ç‡∞µ‡∞∞‡∞ø‡∞§‡∞Ç (Dirgha) „Ä∞</button> -->
                    <button class="button secondary-btn" id="btnClear">‡∞Ö‡∞®‡±ç‡∞®‡±Ä ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø üóëÔ∏è</button>
                </div> -->
            </div>
            <div style="margin-top: 2rem;">
                <label for="mantraTitle">‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞™‡±á‡∞∞‡±Å:</label>
                <input type="text" id="mantraTitle" placeholder="‡∞â‡∞¶‡∞æ: ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å">
            </div>
            <div style="margin-top: 1rem;">
                <label for="mantraDescription">‡∞µ‡∞ø‡∞µ‡∞∞‡∞£:</label>
                <textarea id="mantraDescription" style="min-height: 80px;" placeholder="‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï ‡∞∏‡∞Ç‡∞ï‡±ç‡∞∑‡∞ø‡∞™‡±ç‡∞§ ‡∞µ‡∞ø‡∞µ‡∞∞‡∞£"></textarea>
            </div>
            <div class="flex-container">
                <button class="button" id="btnSaveMantra">‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø ‚ú®</button>
            </div>
        </div>
        
        <div class="section" id="viewMantraSection" style="display: none;">
            <h2>4. ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞≤‡∞®‡±Å ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø & ‡∞∏‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</h2>
            <p style="color: var(--light-text-color);">‡∞í‡∞ï ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞®‡∞ø, ‡∞¶‡∞æ‡∞®‡∞ø‡∞≤‡±ã‡∞®‡∞ø ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞∏‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.</p>
            <div class="tab-container" id="mantraTabContainer"></div>
            <div class="mantra-card" id="mantraDisplayCard">
                <div id="mantraTitleDisplay"><h3></h3></div>
                <div id="mantraDescriptionDisplay"><p></p></div>
                <div id="mantraContentDisplay" class="pitch-display">
                    ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.
                </div>
                <div class="flex-container">
                    <button class="button secondary-btn" id="btnEditMantra" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-edit-3"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                        ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø
                    </button>
                    <button class="button secondary-btn" id="btnDownloadMantra">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                        ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø
                    </button>
                </div>
            </div>
        </div>
  
    </main>

    </div>

    
  <div class="footer-container">

  <footer class="footer-fixed" role="contentinfo">
      <p class="text-sm md:text-base">¬© <span id="currentYear"></span> ‡∞Ö‡∞ï‡±ç‡∞∑‡∞∞‡∞ß‡∞æ‡∞∞ | ‡∞∏‡∞∞‡±ç‡∞µ ‡∞π‡∞ï‡±ç‡∞ï‡±Å‡∞≤‡±Å ‡∞∞‡∞ø‡∞ú‡∞∞‡±ç‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡±ç‡∞°‡∞æ‡∞Ø‡∞ø. | <span id="currentDateTime"></span></p>
  </footer>
</div>

    
    <script>
      document.addEventListener('DOMContentLoaded', function () {
  const hamburger = document.getElementById('hamburger-icon');
  const navLinks = document.getElementById('nav-links');
  
  // Toggle mobile menu open/close
  hamburger.addEventListener('click', function () {
    const expanded = hamburger.getAttribute('aria-expanded') === 'true';
    hamburger.setAttribute('aria-expanded', !expanded);
    navLinks.classList.toggle('active');
  });

  // Find all dropdown containers and their toggle anchors
  const dropdownContainers = document.querySelectorAll('.dropdown');

  dropdownContainers.forEach(dropdown => {
    const toggleLink = dropdown.querySelector('a.nav-link');

    toggleLink.addEventListener('click', function (e) {
      // On small screens only toggle submenu on click
      if (window.innerWidth <= 768) {
        e.preventDefault();
        const expanded = dropdown.getAttribute('aria-expanded') === 'true';
        dropdown.setAttribute('aria-expanded', !expanded);
        dropdown.classList.toggle('open');
      }
    });
  });
});


        let allBooks = {};
        let currentBookKey = null;
        let currentSectionKey = null;
        let currentMantraKey = null;
        let worker;
        let pitchMarks = [];

        const statusElement = document.getElementById('status');
        const bookSelect = document.getElementById('bookSelect');
        const sectionSelect = document.getElementById('sectionSelect');
        const newBookTitleInput = document.getElementById('newBookTitle');
        const createNewBookBtn = document.getElementById('createNewBookBtn');
        const deleteBookBtn = document.getElementById('deleteBookBtn');
        const newSectionTitleInput = document.getElementById('newSectionTitle');
        const addNewSectionBtn = document.getElementById('addNewSectionBtn');
        const deleteSectionBtn = document.getElementById('deleteSectionBtn');
        const imageInput = document.getElementById('imageInput');
        const preview = document.getElementById('preview');
        const btnOcr = document.getElementById('btnOcr');
        const ocrSpinner = document.getElementById('ocrSpinner');
        const ocrTextarea = document.getElementById('ocrText');

        const btnClear = document.getElementById('btnClear');
        const mantraTitleInput = document.getElementById('mantraTitle');
        const mantraDescriptionInput = document.getElementById('mantraDescription');
        const btnSaveMantra = document.getElementById('btnSaveMantra');
        const mantraTabContainer = document.getElementById('mantraTabContainer');
        const mantraTitleDisplay = document.getElementById('mantraTitleDisplay');
        const mantraDescriptionDisplay = document.getElementById('mantraDescriptionDisplay');
        const mantraContentDisplay = document.getElementById('mantraContentDisplay');
        const btnEditMantra = document.getElementById('btnEditMantra');
        const btnDownloadMantra = document.getElementById('btnDownloadMantra');
        const sectionCreationSection = document.getElementById('sectionCreationSection');
        const ocrSection = document.getElementById('ocrSection');
        const viewMantraSection = document.getElementById('viewMantraSection');
        const helperToggleBtn = document.getElementById('helperToggleBtn');
        const helperContent = document.getElementById('helperContent');
        const helperArrow = document.getElementById('helperArrow');

        function updateStatus(message, type = 'info') {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function saveBookData() {
            try {
                localStorage.setItem('aksharadharaBooks', JSON.stringify(allBooks));
            } catch (e) {
                console.error("Failed to save data to local storage:", e);
                updateStatus("‡∞°‡±á‡∞ü‡∞æ ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞¨‡±ç‡∞∞‡±å‡∞ú‡∞∞‡±ç ‡∞∏‡±Ü‡∞ü‡±ç‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç‚Äå‡∞≤‡∞®‡±Å ‡∞§‡∞®‡∞ø‡∞ñ‡±Ä ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.", 'error');
            }
        }

        function loadBookData() {
            try {
                const savedData = localStorage.getItem('aksharadharaBooks');
                if (savedData) {
                    allBooks = JSON.parse(savedData);
                }
            } catch (e) {
                console.error("Failed to load data from local storage:", e);
            }
        }

        async function initWorker() {
            updateStatus("OCR ‡∞á‡∞Ç‡∞ú‡∞ø‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç...", 'info');
            loadBookData();
            renderBookSelect();
            try {
                worker = await Tesseract.createWorker({
                    langPath: "https://tessdata.projectnaptha.com/4.0.0",
                    logger: m => {
                        if (m.status === "recognizing text") {
                            updateStatus(`‡∞µ‡∞ö‡∞®‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç: ${(m.progress * 100).toFixed(2)}%`, 'info');
                        }
                    }
                });
                await worker.loadLanguage("tel");
                await worker.initialize("tel");
                updateStatus("OCR ‡∞á‡∞Ç‡∞ú‡∞ø‡∞®‡±ç ‡∞∏‡∞ø‡∞¶‡±ç‡∞ß‡∞Ç‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø. ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.", 'success');
            } catch (error) {
                console.error("OCR ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠ ‡∞≤‡±ã‡∞™‡∞Ç:", error);
                updateStatus("OCR ‡∞á‡∞Ç‡∞ú‡∞ø‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç‡∞≤‡±ã ‡∞µ‡∞ø‡∞´‡∞≤‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞®‡±Ü‡∞ü‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞ï‡±ç ‡∞ï‡∞®‡±Ü‡∞ï‡±ç‡∞∑‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞§‡∞®‡∞ø‡∞ñ‡±Ä ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.", 'error');
            }
        }
        window.onload = initWorker;

        function renderBookSelect() {
            bookSelect.innerHTML = '<option value="" disabled selected>‡∞í‡∞ï ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø</option>';
            if (Object.keys(allBooks).length > 0) {
                for (const key in allBooks) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = allBooks[key].title;
                    bookSelect.appendChild(option);
                }
                document.getElementById('sectionCreationSection').style.display = 'block';
            } else {
                document.getElementById('sectionCreationSection').style.display = 'none';
            }
        }

        function renderSectionSelect() {
            sectionSelect.innerHTML = '<option value="" disabled selected>‡∞í‡∞ï ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø</option>';
            if (currentBookKey && allBooks[currentBookKey].sections) {
                for (const key in allBooks[currentBookKey].sections) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = allBooks[currentBookKey].sections[key].title;
                    sectionSelect.appendChild(option);
                }
                document.getElementById('ocrSection').style.display = 'block';
                document.getElementById('viewMantraSection').style.display = 'block';
            } else {
                document.getElementById('ocrSection').style.display = 'none';
                document.getElementById('viewMantraSection').style.display = 'none';
            }
        }

        function renderMantraTabs() {
            mantraTabContainer.innerHTML = '';
            btnEditMantra.disabled = true;
            if (currentBookKey && currentSectionKey && allBooks[currentBookKey].sections[currentSectionKey].mantras) {
                const mantras = allBooks[currentBookKey].sections[currentSectionKey].mantras;
                const mantraKeys = Object.keys(mantras);
                if (mantraKeys.length > 0) {
                    mantraKeys.forEach((key, index) => {
                        const mantra = mantras[key];
                        const tabButton = document.createElement('button');
                        tabButton.className = 'tab-button';
                        tabButton.setAttribute('data-key', key);
                        tabButton.textContent = mantra.title;
                        tabButton.addEventListener('click', () => {
                            loadMantra(key);
                        });
                        mantraTabContainer.appendChild(tabButton);
                    });
                    
                    if (currentMantraKey && mantras[currentMantraKey]) {
                        loadMantra(currentMantraKey);
                    } else {
                        // Load the first mantra by default
                        loadMantra(mantraKeys[0]);
                    }
                } else {
                    mantraTitleDisplay.innerHTML = '<h3>‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞≤‡±á‡∞¶‡±Å</h3>';
                    mantraDescriptionDisplay.innerHTML = '<p>‡∞à ‡∞≠‡∞æ‡∞ó‡∞Ç‡∞≤‡±ã ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞≤‡±á‡∞¶‡±Å. ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.</p>';
                    mantraContentDisplay.innerHTML = '';
                }
            } else {
                 mantraTitleDisplay.innerHTML = '<h3>‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞≤‡±á‡∞¶‡±Å</h3>';
                mantraDescriptionDisplay.innerHTML = '<p>‡∞à ‡∞≠‡∞æ‡∞ó‡∞Ç‡∞≤‡±ã ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞≤‡±á‡∞¶‡±Å. ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.</p>';
                mantraContentDisplay.innerHTML = '';
            }
        }

        function getGraphemeIndices(text, startIndex, endIndex) {
            const segmenter = new Intl.Segmenter('te', { granularity: 'grapheme' });
            const segments = Array.from(segmenter.segment(text));
            let indices = [];
            let charIndex = 0;
            for (let i = 0; i < segments.length; i++) {
                const seg = segments[i].segment;
                const segmentEndIndex = charIndex + seg.length;
                if (segmentEndIndex > startIndex && charIndex < endIndex) {
                    indices.push(i);
                }
                charIndex = segmentEndIndex;
            }
            return indices;
        }

        function preparePitches(pitchType) {
            const fullText = ocrTextarea.value;
            const startIndex = ocrTextarea.selectionStart;
            const endIndex = ocrTextarea.selectionEnd;

            if (startIndex === endIndex) {
                alert("‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø OCR ‡∞Ö‡∞µ‡±Å‡∞ü‡±ç‚Äå‡∞™‡±Å‡∞ü‡±ç ‡∞¨‡∞æ‡∞ï‡±ç‡∞∏‡±ç‚Äå‡∞≤‡±ã ‡∞ï‡±ä‡∞Ç‡∞§ ‡∞µ‡∞ö‡∞®‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.");
                return;
            }
            
            const selectedGraphemeIndices = getGraphemeIndices(fullText, startIndex, endIndex);
            selectedGraphemeIndices.forEach(index => {
                pitchMarks[index] = pitchType;
            });
            updateStatus(`‡∞™‡∞ø‡∞ö‡±ç‚Äå‡∞≤‡±Å ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡±ç‡∞°‡∞æ‡∞Ø‡∞ø. ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞µ‡∞ö‡±ç‡∞ö‡±Å.`, 'info');
        }

        function loadMantra(key) {
            const mantras = allBooks[currentBookKey].sections[currentSectionKey].mantras;
            const mantra = mantras[key];
            if (!mantra) return;

            currentMantraKey = key;
            mantraTitleDisplay.innerHTML = `<h3>${mantra.title}</h3>`;
            mantraDescriptionDisplay.innerHTML = `<p>${mantra.description}</p>`;
            
            let htmlContent = '';
            mantra.instructions.forEach(instruction => {
                instruction.mantra.forEach(line => {
                    line.forEach(syllable => {
                        const pitchClass = syllable.pitch ? `pitch-marked-char ${syllable.pitch}` : '';
                        htmlContent += `<span class="${pitchClass}">${syllable.char}</span>`;
                    });
                    htmlContent += '<br>';
                });
            });
            mantraContentDisplay.innerHTML = htmlContent;

            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            const selectedTab = document.querySelector(`.tab-button[data-key="${key}"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
                btnEditMantra.disabled = false;
            }
        }

        function downloadBook() {
            if (!currentBookKey) {
                alert("‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞í‡∞ï ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.");
                return;
            }

            const book = allBooks[currentBookKey];
            const creationDate = new Date().toLocaleString('te-IN', { timeZone: 'Asia/Kolkata', dateStyle: 'long', timeStyle: 'short' });
            
            let htmlContent = `
                <!DOCTYPE html>
                <html lang="te">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${book.title} - ‡∞∂‡±Å‡∞ï‡±ç‡∞≤‡∞Ø‡∞ú‡±Å‡∞∞‡±ç‡∞µ‡±á‡∞¶‡∞Ç</title>
                    <link rel="preconnect" href="https://fonts.googleapis.com">
                    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
                    <style>
                        body { font-family: 'Noto Sans Telugu', serif; background-color: #f0f4f8; color: #2d3748; padding: 2rem; }
                        h1 { color: #4c51bf; text-align: center; }
                        h2, h3 { color: #5a67d8; border-bottom: 1px solid #cbd5e1; padding-bottom: 0.5rem; margin-top: 2rem; }
                        .section { background-color: white; padding: 1.5rem; margin-bottom: 1.5rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
                        .pitch-display { font-size: 1.25rem; line-height: 2.2; white-space: pre-wrap; word-wrap: break-word; text-align: justify; }
                        .pitch-marked-char { position: relative; display: inline-flex; flex-direction: column; align-items: center; line-height: 1.5; text-align: center; padding: 0.4em 0.2em; }
                        .pitch-marked-char.high::before { content: "‚ñ≤"; position: absolute; top: -0.7em; left: 50%; transform: translateX(-50%); color: #1f3674; font-size: 0.8em; margin-top: 0.2em; }
                        .pitch-marked-char.low::after { content: "‚ñº"; position: absolute; bottom: -0.5em; left: 50%; transform: translateX(-50%); color: #a08b5e; font-size: 0.8em; }
                        .pitch-marked-char.svarita::before { content: "‚åí"; position: absolute; top: -0.7em; left: 50%; transform: translateX(-50%); color: #c0392b; font-size: 0.8em; margin-top: 0.2em; }
                        .pitch-marked-char.dirgha-svarita::before { content: "„Ä∞"; position: absolute; top: -0.7em; left: 50%; transform: translateX(-50%); color: #27ae60; font-size: 0.8em; margin-top: 0.2em; }
                        footer { text-align: center; padding: 20px; font-family: sans-serif; border-top: 1px solid #e0e0e0; margin-top: 20px; color: #777; font-size: 14px; }
                    </style>
                </head>
                <body>
                    <h1>${book.title}</h1>
            `;

            for (const sectionKey in book.sections) {
                const section = book.sections[sectionKey];
                htmlContent += `<div class="section"><h2>${section.title}</h2>`;
                for (const mantraKey in section.mantras) {
                    const mantra = section.mantras[mantraKey];
                    htmlContent += `<h3>${mantra.title}</h3><p>${mantra.description}</p><div class="pitch-display">`;
                    mantra.instructions.forEach(instruction => {
                        instruction.mantra.forEach(line => {
                            line.forEach(syllable => {
                                const pitchClass = syllable.pitch ? `pitch-marked-char ${syllable.pitch}` : '';
                                htmlContent += `<span class="${pitchClass}">${syllable.char}</span>`;
                            });
                            htmlContent += '<br>';
                        });
                    });
                    htmlContent += `</div>`;
                }
                htmlContent += `</div>`;
            }

            htmlContent += `
                <footer style="text-align: center; padding: 20px; font-family: sans-serif; border-top: 1px solid #e0e0e0; margin-top: 20px;">
                    <p style="color: #777; font-size: 14px;">
                        ‡∞ï‡±ç‡∞∞‡∞ø‡∞Ø‡±á‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞®‡∞¶‡∞ø: ${creationDate}
                        <br>
                        ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞ø‡∞®‡∞µ‡∞æ‡∞∞‡±Å: ‡∞Ö‡∞ï‡±ç‡∞∑‡∞∞‡∞ß‡∞æ‡∞∞ ‡∞∏‡∞æ‡∞´‡±ç‡∞ü‡±ç‚Äå‡∞µ‡±á‡∞∞‡±ç
                        <br>
                        ‡∞é‡∞≤‡∞æ ‡∞∞‡±Ç‡∞™‡±ä‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø:
                        <br>
                        1. ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç OCR ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø, , 2. ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±ç ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç‡∞ó‡∞æ ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.
                    </p>
                </footer>
                </body></html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${book.title.replace(/\s/g, '_')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            updateStatus(`'${book.title}' ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.`, 'success');
        }

        // Event Listeners for New Functionality
        createNewBookBtn.addEventListener('click', () => {
            const title = newBookTitleInput.value.trim();
            if (!title) {
                alert("‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞™‡±á‡∞∞‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.");
                return;
            }
            const key = title.replace(/\s+/g, '');
            if (allBooks[key]) {
                alert("‡∞à ‡∞™‡±á‡∞∞‡±Å‡∞§‡±ã ‡∞í‡∞ï ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç ‡∞á‡∞™‡±ç‡∞™‡∞ü‡∞ø‡∞ï‡±á ‡∞â‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞µ‡±á‡∞∞‡±á ‡∞™‡±á‡∞∞‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.");
                return;
            }
            allBooks[key] = { title: title, sections: {} };
            currentBookKey = key;
            saveBookData();
            renderBookSelect();
            renderSectionSelect();
            bookSelect.value = key;
            updateStatus(`‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç '${title}' ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.`, 'success');
        });

        bookSelect.addEventListener('change', (e) => {
            currentBookKey = e.target.value;
            currentSectionKey = null;
            renderSectionSelect();
            updateStatus(`‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç '${allBooks[currentBookKey].title}' ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.`, 'info');
        });

        deleteBookBtn.addEventListener('click', () => {
            if (!currentBookKey) {
                alert("‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞í‡∞ï ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.");
                return;
            }
            if (confirm(`‡∞Æ‡±Ä‡∞∞‡±Å '${allBooks[currentBookKey].title}' ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞ñ‡∞ö‡±ç‡∞ö‡∞ø‡∞§‡∞Ç‡∞ó‡∞æ ‡∞Ö‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡∞æ?`)) {
                delete allBooks[currentBookKey];
                currentBookKey = null;
                currentSectionKey = null;
                saveBookData();
                renderBookSelect();
                renderSectionSelect();
                updateStatus("‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.", 'success');
            }
        });

        addNewSectionBtn.addEventListener('click', () => {
            if (!currentBookKey) {
                alert("‡∞Æ‡±ä‡∞¶‡∞ü ‡∞í‡∞ï ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.");
                return;
            }
            const title = newSectionTitleInput.value.trim();
            if (!title) {
                alert("‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞™‡±á‡∞∞‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.");
                return;
            }
            const key = title.replace(/\s+/g, '');
            if (allBooks[currentBookKey].sections[key]) {
                alert("‡∞à ‡∞™‡±á‡∞∞‡±Å‡∞§‡±ã ‡∞í‡∞ï ‡∞≠‡∞æ‡∞ó‡∞Ç ‡∞á‡∞™‡±ç‡∞™‡∞ü‡∞ø‡∞ï‡±á ‡∞â‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞µ‡±á‡∞∞‡±á ‡∞™‡±á‡∞∞‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.");
                return;
            }
            allBooks[currentBookKey].sections[key] = { title: title, mantras: {} };
            currentSectionKey = key;
            saveBookData();
            renderSectionSelect();
            renderMantraTabs();
            sectionSelect.value = key;
            updateStatus(`'${title}' ‡∞≠‡∞æ‡∞ó‡∞Ç ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å OCR ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.`, 'success');
        });

        sectionSelect.addEventListener('change', (e) => {
            currentSectionKey = e.target.value;
            renderMantraTabs();
            updateStatus(`'${allBooks[currentBookKey].sections[currentSectionKey].title}' ‡∞≠‡∞æ‡∞ó‡∞Ç ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞∏‡∞ø‡∞¶‡±ç‡∞ß‡∞Ç‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø.`, 'info');
        });
        
        deleteSectionBtn.addEventListener('click', () => {
            if (!currentBookKey || !currentSectionKey) {
                alert("‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞í‡∞ï ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.");
                return;
            }
            if (confirm(`‡∞Æ‡±Ä‡∞∞‡±Å '${allBooks[currentBookKey].sections[currentSectionKey].title}' ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞ñ‡∞ö‡±ç‡∞ö‡∞ø‡∞§‡∞Ç‡∞ó‡∞æ ‡∞Ö‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡∞æ?`)) {
                delete allBooks[currentBookKey].sections[currentSectionKey];
                currentSectionKey = null;
                saveBookData();
                renderSectionSelect();
                renderMantraTabs();
                updateStatus("‡∞≠‡∞æ‡∞ó‡∞Ç ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.", 'success');
            }
        });

        // Existing Event Listeners
        imageInput.addEventListener('change', () => {
            if (imageInput.files.length === 0) return;
            const file = imageInput.files[0];
            preview.src = URL.createObjectURL(file);
            preview.style.display = 'block';
            updateStatus("‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç ‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. 'OCR ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø' ‡∞™‡±à ‡∞ï‡±ç‡∞≤‡∞ø‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.", 'info');
            btnOcr.disabled = false;
            ocrTextarea.value = "";
            pitchMarks = [];
        });

        btnOcr.addEventListener('click', async () => {
            if (!imageInput.files[0] || !worker) return;
            btnOcr.disabled = true;
            ocrSpinner.style.display = 'inline-block';
            updateStatus("OCR ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...", 'info');
            try {
                const { data } = await worker.recognize(imageInput.files[0], 'tel');
                const sanitizedText = data.text.replace(/[\u030D\u0323]/g, '').trim();
                ocrTextarea.value = sanitizedText;
                const segmenter = new Intl.Segmenter('te', { granularity: 'grapheme' });
                const segments = Array.from(segmenter.segment(sanitizedText));
                pitchMarks = Array(segments.length).fill('none');
                updateStatus("OCR ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞µ‡∞ö‡∞®‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞®‡∞ø ‡∞™‡∞ø‡∞ö‡±ç ‡∞¨‡∞ü‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞ï‡±ç‡∞≤‡∞ø‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.", 'success');
            } catch (error) {
                updateStatus("OCR ‡∞∏‡∞Æ‡∞Ø‡∞Ç‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç ‡∞∏‡∞Ç‡∞≠‡∞µ‡∞ø‡∞Ç‡∞ö‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞µ‡±á‡∞∞‡±á ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.", 'error');
                console.error("OCR ‡∞≤‡±ã‡∞™‡∞Ç:", error);
            } finally {
                btnOcr.disabled = false;
                ocrSpinner.style.display = 'none';
            }
        });

    /*     btnPitchHigh.addEventListener('click', () => preparePitches('high'));
        btnPitchLow.addEventListener('click', () => preparePitches('low')); */
  /*       btnPitchSvarita.addEventListener('click', () => preparePitches('svarita'));
        btnPitchDirgha.addEventListener('click', () => preparePitches('dirgha-svarita')); */
        btnClear.addEventListener('click', () => {
            ocrTextarea.value = '';
            imageInput.value = '';
            preview.style.display = 'none';
            btnOcr.disabled = true;
            pitchMarks = [];
            mantraTitleInput.value = '';
            mantraDescriptionInput.value = '';
            currentMantraKey = null;
            updateStatus('‡∞Ö‡∞®‡±ç‡∞®‡∞ø OCR ‡∞ï‡∞Ç‡∞ü‡±Ü‡∞Ç‡∞ü‡±ç ‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞∏‡∞ø, ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.', 'info');
            btnSaveMantra.textContent = '‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø ‚ú®';
        });

        btnSaveMantra.addEventListener('click', () => {
            if (!currentBookKey || !currentSectionKey) {
                alert("‡∞Æ‡±ä‡∞¶‡∞ü ‡∞í‡∞ï ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞≠‡∞æ‡∞ó‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.");
                return;
            }
            const title = mantraTitleInput.value.trim();
            const description = mantraDescriptionInput.value.trim();
            const fullText = ocrTextarea.value;
            
            if (!title) {
                alert('‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞í‡∞ï ‡∞™‡±ç‡∞∞‡∞§‡±ç‡∞Ø‡±á‡∞ï‡∞Æ‡±à‡∞® ‡∞™‡±á‡∞∞‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.');
                return;
            }
            const newKey = title.replace(/\s+/g, '');
            if (newKey !== currentMantraKey && allBooks[currentBookKey].sections[currentSectionKey].mantras[newKey]) {
                alert(`'${title}' ‡∞™‡±á‡∞∞‡±Å‡∞§‡±ã ‡∞í‡∞ï ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞á‡∞™‡±ç‡∞™‡∞ü‡∞ø‡∞ï‡±á ‡∞â‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞™‡±ç‡∞∞‡∞§‡±ç‡∞Ø‡±á‡∞ï‡∞Æ‡±à‡∞® ‡∞™‡±á‡∞∞‡±Å‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.`);
                return;
            }
            if (fullText.trim().length === 0) {
                alert('OCR ‡∞Ö‡∞µ‡±Å‡∞ü‡±ç‚Äå‡∞™‡±Å‡∞ü‡±ç ‡∞ñ‡∞æ‡∞≥‡±Ä‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø OCR ‡∞ö‡±á‡∞∏‡∞ø, ‡∞Ü‡∞™‡±à ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.');
                return;
            }
            
            const segmenter = new Intl.Segmenter('te', { granularity: 'grapheme' });
            const segments = Array.from(segmenter.segment(fullText));
            let mantraInstructions = [];
            let currentLine = [];
            segments.forEach((seg, index) => {
                const char = seg.segment;
                const pitch = pitchMarks[index];
                if (char.includes('\n')) {
                    if (currentLine.length > 0) {
                        mantraInstructions.push({ mantra: [currentLine] });
                        currentLine = [];
                    }
                    return;
                }
                let syllable = { char: char };
                if (pitch && pitch !== 'none') {
                    syllable.pitch = pitch;
                }
                currentLine.push(syllable);
            });
            if (currentLine.length > 0) {
                mantraInstructions.push({ mantra: [currentLine] });
            }
            
            const newMantra = {
                title: title,
                description: description,
                instructions: mantraInstructions
            };
            
            const keyToUse = currentMantraKey || newKey;
            allBooks[currentBookKey].sections[currentSectionKey].mantras[keyToUse] = newMantra;
            
            saveBookData();
            renderMantraTabs();
            loadMantra(keyToUse);
            mantraTitleInput.value = '';
            mantraDescriptionInput.value = '';
            ocrTextarea.value = '';
            pitchMarks = [];
            currentMantraKey = null;
            updateStatus(`'${title}' ‡∞™‡∞æ‡∞†‡±ç‡∞Ø‡∞Æ‡±Å ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.`, 'success');
            btnSaveMantra.textContent = '‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±á‡∞µ‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø ‚ú®';
        });
        
        btnEditMantra.addEventListener('click', () => {
            if (!currentMantraKey) {
                alert("‡∞∏‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞í‡∞ï ‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.");
                return;
            }
            const mantra = allBooks[currentBookKey].sections[currentSectionKey].mantras[currentMantraKey];
            mantraTitleInput.value = mantra.title;
            mantraDescriptionInput.value = mantra.description;
            
            let fullText = '';
            let tempPitchMarks = [];
            
            mantra.instructions.forEach(instruction => {
                instruction.mantra.forEach(line => {
                    line.forEach(syllable => {
                        fullText += syllable.char;
                        tempPitchMarks.push(syllable.pitch || 'none');
                    });
                    fullText += '\n';
                    tempPitchMarks.push('none'); // Add a marker for the newline
                });
            });
            
            // Remove trailing newline and its pitch marker
            fullText = fullText.trim();
            tempPitchMarks = tempPitchMarks.slice(0, tempPitchMarks.length - 1);
            
            ocrTextarea.value = fullText;
            pitchMarks = tempPitchMarks;
            
            updateStatus("‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞∏‡∞ø‡∞¶‡±ç‡∞ß‡∞Ç‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø.", 'info');
            btnSaveMantra.textContent = '‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Ö‡∞™‡±ç‚Äå‡∞°‡±á‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø ‚úèÔ∏è';
        });

        btnDownloadMantra.addEventListener('click', downloadBook);

        helperToggleBtn.addEventListener('click', () => {
            const isVisible = helperContent.style.display === 'block';
            helperContent.style.display = isVisible ? 'none' : 'block';
            helperArrow.textContent = isVisible ? '‚ñº' : '‚ñ≤';
        });

        // Initial rendering on page load
        renderBookSelect();
        renderSectionSelect();
        renderMantraTabs();
    </script>
</body>
</html>
